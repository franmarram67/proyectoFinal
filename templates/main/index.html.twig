{% extends 'base.html.twig' %}

{% block title %}Tournament Master{% endblock %}

{% block body %}


{% if is_granted("ROLE_USER") %}
    {% if app.user.verified == true %}
        <a href="/tournament/new">Create New Tournament</a>
    {% endif %}
{% endif %}
<h2>Tournaments</h2>
<ul>
{% for tournament in tournaments %}
    <li>
        <h3><a href="/seetournament/{{tournament.id}}">{{tournament.title}}</a> - by {{tournament.creatorUser.username}}</h3>
        <p>{{ tournament.description|length > 50 ? tournament.description|slice(0, 50) ~ '...' : tournament.description  }}</p>
        <p>VideoGame: {{ tournament.videogame }}</p>
        <p>Places: {{tournament.players|length}}/20</p>
        <h4>Start Date: {{tournament.startDate|date('Y-m-d  H:i:s') }}</h4>
        {% if is_granted("ROLE_USER") %}
            {% if app.user not in tournament.players %}
                {% if app.user.verified == true %}
                    {% if app.user.id != tournament.creatorUser.id %}
                        {% if date() < date(tournament.startDate) %}
                            {% if tournament.players|length < 20 %}
                                <a href="/signuptotournament/{{tournament.id}}">Sign Up</a>
                            {% else %}
                                You can't Sign Up to this Tournament because there's no more places left. Max 20 players per tournament.
                            {% endif %}
                        {% else %}
                            You can't Sign Up to this Tournament the date to Sign Up has expired. You have to Sign Up before the Start Date.
                        {% endif %}
                    {% else %}
                        You can't Sign Up to your own Tournament.<br><br>
                        {% if date() > date(tournament.startDate) %}
                            <a href="/finishtournament/{{tournament.id}}">Finish Tournament</a>
                        {% endif %}
                    {% endif %}
                {% else %}
                    You can't Sign Up to this Tournament because you're not a verified user.
                {% endif %}
            {% else %}
                You already Signed Up to this Tournament.
            {% endif %}
        {% else %}
            Login to be able to Sign Up to this Tournament.
        {% endif %}
        
    </li>
{% endfor %}
</ul>

{% endblock %}
